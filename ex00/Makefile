# Globify - Makefile
# Quick commands for Docker management

.PHONY: help build up down restart logs clean rebuild test setup

# Default target
help:
	@echo "Globify - Available commands:"
	@echo ""
	@echo "  make setup      - Initial setup (create config.local.js from template)"
	@echo "  make build      - Build Docker image"
	@echo "  make up         - Start the application"
	@echo "  make down       - Stop the application"
	@echo "  make restart    - Restart the application"
	@echo "  make rebuild    - Rebuild and restart"
	@echo "  make logs       - Show application logs"
	@echo "  make clean      - Stop and remove containers, images, and volumes"
	@echo "  make test       - Test if the app is running"
	@echo ""
	@echo "Quick start:"
	@echo "  1. make setup"
	@echo "  2. Edit src/scripts/config.local.js with your Spotify Client ID"
	@echo "  3. make up"
	@echo "  4. Open https://localhost:8080"

# Initial setup
setup:
	@if [ ! -f src/scripts/config.local.js ]; then \
		cp src/scripts/config.local.example.js src/scripts/config.local.js; \
		echo "âœ… Created config.local.js"; \
		echo "âš ï¸  IMPORTANT: Edit src/scripts/config.local.js and add your Spotify Client ID"; \
	else \
		echo "âš ï¸  config.local.js already exists"; \
	fi

# Build Docker image
build:
	@echo "ğŸ”¨ Building Docker image..."
	docker-compose build

# Start application
up:
	@echo "ğŸš€ Starting Globify..."
	docker-compose up -d
	@echo ""
	@echo "âœ… Globify is running!"
	@echo "ğŸŒ Open: http://127.0.0.1:8080"
	@echo "ğŸ“‹ Logs: make logs"
	@echo "ğŸ›‘ Stop: make down"

# Stop application
down:
	@echo "ğŸ›‘ Stopping Globify..."
	docker-compose down

# Restart application
restart: down up

# Rebuild and restart
rebuild:
	@echo "ğŸ”„ Rebuilding and restarting..."
	docker-compose down
	docker-compose build
	docker-compose up -d
	@echo "âœ… Done!"

# Show logs
logs:
	docker-compose logs -f

# Clean everything
clean:
	@echo "ğŸ§¹ Cleaning up..."
	docker-compose down -v
	docker rmi ex00-web 2>/dev/null || true
	@echo "âœ… Cleanup complete"

# Test if running
test:
	@echo "ğŸ” Testing if Globify is running..."
	@curl -s http://127.0.0.1:8080 > /dev/null && echo "âœ… App is running at http://127.0.0.1:8080" || echo "âŒ App is not running. Try: make up"

# Development mode with logs
dev:
	@echo "ğŸ”§ Starting in development mode..."
	docker-compose up
